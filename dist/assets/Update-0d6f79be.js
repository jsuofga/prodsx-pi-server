import{_ as f,G as _,$ as m,H as s,I as d,J as u,P as r,N as i,S as l,B as g,O as h,a0 as v,U as p}from"./index-8c997e98.js";import{V as b}from"./VContainer-ad3f8978.js";import{V as w,b as B}from"./VProgressCircular-ce7eb7e7.js";const y={name:"Update",props:[],setup(){return{stateStore:_()}},data(){return{selectedFile:null,completion:"0%",showFileButton:!0,showUploadButton:!1,showProgressBar:!1,rebooting:!1,interval:{},value:0}},computed:{},methods:{startTimer(){this.interval=setInterval(()=>{this.value=this.value===100?0:this.value+1,this.value==100&&(this.rebooting=!1,this.$router.push("/"),setTimeout(function(){location.reload()},3e3))},600)},fileSelect(a){this.showFileButton=!1,this.showUploadButton=!0,this.selectedFile=a.target.files[0]},upload(){const a=`${location.hostname}:1880`,o=new FormData;this.selectedFile==null?alert("No file selected"):this.selectedFile.type=="application/x-tar"&&this.selectedFile.name=="dist.tar"?(this.showFileButton=!1,this.showUploadButton=!1,this.showProgressBar=!0,o.append("image",this.selectedFile),m.post(`http://${a}/update`,o,{onUploadProgress:t=>{console.log("upload progress:"+Math.round(t.loaded/t.total*100)+"%"),this.completion=Math.round(t.loaded/t.total*100).toString()+"%"}}).then(t=>{console.log(t.status),t.status===200?(this.rebooting=!0,this.startTimer()):alert("fail")}).catch(t=>{this.errors.push(t)})):alert("Wrong file.File should be dist.tar. Please contact info@octavainc.com to get correct file")}},async created(){this.stateStore.showSideMenu=!1},mounted(){},beforeUnmount(){clearInterval(this.interval)}},F={class:"update"},S={key:0},U={key:1,id:"input"},k={key:2,class:"field center-align"},V={key:3,id:"progress-container"},x={class:"progress"},P={key:0,class:"progressFeedback"},C={key:2};function N(a,o,t,I,e,n){return s(),d(b,null,{default:u(()=>[r("div",F,[e.rebooting?l("",!0):(s(),i("h5",S," Update dist.tar file")),e.showFileButton?(s(),i("div",U,[r("input",{onChange:o[0]||(o[0]=(...c)=>n.fileSelect&&n.fileSelect(...c)),id:"file-select-button",type:"file",accept:".tar"},null,32)])):l("",!0),e.showUploadButton?(s(),i("div",k,[r("button",{onClick:o[1]||(o[1]=(...c)=>n.upload&&n.upload(...c)),class:"waves-effect waves-light btn blue"},[g(w,{icon:"mdi-upload"}),h("publish upload")])])):l("",!0),e.showProgressBar?(s(),i("div",V,[r("div",x,[r("div",{class:"determinate blue",style:v({width:e.completion})},null,4)]),e.rebooting?l("",!0):(s(),i("div",P,"Uploading "+p(e.completion),1)),e.rebooting?(s(),d(B,{key:1,"model-value":e.value,rotate:360,size:100,width:15,color:"blue"},{default:u(()=>[h(p(e.value),1)]),_:1},8,["model-value"])):l("",!0),e.rebooting?(s(),i("div",C," Please Wait. Restarting Controller ")):l("",!0)])):l("",!0)])]),_:1})}const D=f(y,[["render",N],["__scopeId","data-v-864ae7df"]]);export{D as default};
